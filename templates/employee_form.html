{% extends "base.html" %}

{% block title %}{{ 'Sửa thông tin' if employee else 'Thêm nhân sự mới' }} - HRMS{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-user-{{ 'edit' if employee else 'plus' }}"></i>
                        {{ 'Sửa thông tin nhân sự' if employee else 'Thêm nhân sự mới' }}
                    </h4>
                </div>
                <div class="card-body">
                    <form method="POST" class="needs-validation" novalidate>
                        <!-- Thông tin cơ bản -->
                        <h5 class="mb-3 text-primary">
                            <i class="fas fa-info-circle"></i> Thông tin cơ bản
                        </h5>
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label for="employee_code" class="form-label">Mã nhân viên <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="employee_code" name="employee_code" 
                                       value="{{ employee.employee_code if employee else '' }}" required
                                       {{ 'readonly' if employee else '' }}>
                            </div>
                            <div class="col-md-5">
                                <label for="full_name" class="form-label">Họ và tên <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="full_name" name="full_name" 
                                       value="{{ employee.full_name if employee else '' }}" required>
                            </div>
                            <div class="col-md-2">
                                <label for="date_of_birth" class="form-label">Ngày sinh</label>
                                <input type="date" class="form-control" id="date_of_birth" name="date_of_birth"
                                       value="{{ employee.date_of_birth.strftime('%Y-%m-%d') if employee and employee.date_of_birth else '' }}">
                            </div>
                            <div class="col-md-2">
                                <label for="gender" class="form-label">Giới tính</label>
                                <select class="form-select" id="gender" name="gender">
                                    <option value="">-- Chọn --</option>
                                    <option value="Nam" {{ 'selected' if employee and employee.gender == 'Nam' else '' }}>Nam</option>
                                    <option value="Nữ" {{ 'selected' if employee and employee.gender == 'Nữ' else '' }}>Nữ</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label for="ethnicity" class="form-label">Dân tộc</label>
                                <input type="text" class="form-control" id="ethnicity" name="ethnicity"
                                       value="{{ employee.ethnicity if employee else '' }}" placeholder="VD: Kinh">
                            </div>
                            <div class="col-md-3">
                                <label for="religion" class="form-label">Tôn giáo</label>
                                <input type="text" class="form-control" id="religion" name="religion"
                                       value="{{ employee.religion if employee else '' }}" placeholder="VD: Không">
                            </div>
                            <div class="col-md-6">
                                <label for="hometown" class="form-label">Quê quán</label>
                                <input type="text" class="form-control" id="hometown" name="hometown"
                                       value="{{ employee.hometown if employee else '' }}" 
                                       placeholder="VD: Xã A, Huyện B, Tỉnh C">
                            </div>
                        </div>
                        
                        <hr class="my-4">
                        
                        <!-- Thông tin công việc -->
                        <h5 class="mb-3 text-primary">
                            <i class="fas fa-briefcase"></i> Thông tin công việc
                        </h5>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="position" class="form-label">Chức vụ</label>
                                <input type="text" class="form-control" id="position" name="position"
                                       value="{{ employee.position if employee else '' }}"
                                       placeholder="VD: Chuyên viên">
                            </div>
                            <div class="col-md-4">
                                <label for="department" class="form-label">Đơn vị</label>
                                <input type="text" class="form-control" id="department" name="department"
                                       value="{{ employee.department if employee else '' }}"
                                       placeholder="VD: Phòng Tổ chức - Hành chính">
                            </div>
                            <div class="col-md-4">
                                <label for="party_join_date" class="form-label">Ngày vào Đảng</label>
                                <input type="date" class="form-control" id="party_join_date" name="party_join_date"
                                       value="{{ employee.party_join_date.strftime('%Y-%m-%d') if employee and employee.party_join_date else '' }}">
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="political_theory_level" class="form-label">Trình độ lý luận chính trị</label>
                                <select class="form-select" id="political_theory_level" name="political_theory_level">
                                    <option value="">-- Chọn --</option>
                                    <option value="Sơ cấp" {{ 'selected' if employee and employee.political_theory_level == 'Sơ cấp' else '' }}>Sơ cấp</option>
                                    <option value="Trung cấp" {{ 'selected' if employee and employee.political_theory_level == 'Trung cấp' else '' }}>Trung cấp</option>
                                    <option value="Cao cấp" {{ 'selected' if employee and employee.political_theory_level == 'Cao cấp' else '' }}>Cao cấp</option>
                                    <option value="Cử nhân" {{ 'selected' if employee and employee.political_theory_level == 'Cử nhân' else '' }}>Cử nhân</option>
                                </select>
                            </div>
                            <div class="col-md-8">
                                <label for="professional_level" class="form-label">Trình độ chuyên môn</label>
                                <input type="text" class="form-control" id="professional_level" name="professional_level"
                                       value="{{ employee.professional_level if employee else '' }}"
                                       placeholder="VD: Cử nhân Kinh tế, Thạc sĩ Quản trị kinh doanh">
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="start_date" class="form-label">Ngày bắt đầu công tác <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="start_date" name="start_date"
                                       value="{{ employee.start_date.strftime('%Y-%m-%d') if employee and employee.start_date else '' }}" required>
                            </div>
                            <div class="col-md-4">
                                <label for="organization_start_date" class="form-label">Ngày vào cơ quan</label>
                                <input type="date" class="form-control" id="organization_start_date" name="organization_start_date"
                                       value="{{ employee.organization_start_date.strftime('%Y-%m-%d') if employee and employee.organization_start_date else '' }}">
                            </div>
                            <div class="col-md-4">
                                <label for="status" class="form-label">Trạng thái</label>
                                <select class="form-select" id="status" name="status">
                                    <option value="active" {{ 'selected' if not employee or employee.status == 'active' else '' }}>Đang làm việc</option>
                                    <option value="leave" {{ 'selected' if employee and employee.status == 'leave' else '' }}>Nghỉ phép</option>
                                    <option value="studying" {{ 'selected' if employee and employee.status == 'studying' else '' }}>Đi học</option>
                                    <option value="retired" {{ 'selected' if employee and employee.status == 'retired' else '' }}>Nghỉ hưu</option>
                                </select>
                            </div>
                        </div>
                        
                        <hr class="my-4">
                        
                        <!-- Thông tin lương -->
                        <h5 class="mb-3 text-primary">
                            <i class="fas fa-money-bill-wave"></i> Thông tin lương
                        </h5>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="current_salary_level" class="form-label">Ngạch lương</label>
                                <input type="text" class="form-control" id="current_salary_level" name="current_salary_level"
                                       value="{{ employee.current_salary_level if employee else '' }}"
                                       placeholder="VD: Chuyên viên">
                            </div>
                            <div class="col-md-3">
                                <label for="current_salary_coefficient" class="form-label">Hệ số lương</label>
                                <input type="number" step="0.01" class="form-control" id="current_salary_coefficient" name="current_salary_coefficient"
                                       value="{{ employee.current_salary_coefficient if employee else '' }}"
                                       placeholder="VD: 2.34">
                            </div>
                            <div class="col-md-3">
                                <label for="position_allowance" class="form-label">Phụ cấp chức vụ</label>
                                <input type="number" step="0.01" class="form-control" id="position_allowance" name="position_allowance"
                                       value="{{ employee.position_allowance if employee else '0' }}">
                            </div>
                            <div class="col-md-2">
                                <label for="last_salary_increase_date" class="form-label">Ngày nâng gần nhất</label>
                                <input type="date" class="form-control" id="last_salary_increase_date" name="last_salary_increase_date"
                                       value="{{ employee.last_salary_increase_date.strftime('%Y-%m-%d') if employee and employee.last_salary_increase_date else '' }}">
                            </div>
                        </div>
                        
                        <hr class="my-4">
                        
                        <!-- Thông tin liên hệ -->
                        <h5 class="mb-3 text-primary">
                            <i class="fas fa-address-card"></i> Thông tin liên hệ
                        </h5>
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label for="phone" class="form-label">Điện thoại</label>
                                <input type="tel" class="form-control" id="phone" name="phone"
                                       value="{{ employee.phone if employee else '' }}"
                                       placeholder="VD: 0901234567">
                            </div>
                            <div class="col-md-4">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" name="email"
                                       value="{{ employee.email if employee else '' }}"
                                       placeholder="VD: nhanvien@email.com">
                            </div>
                            <div class="col-md-5">
                                <label for="address" class="form-label">Địa chỉ</label>
                                <input type="text" class="form-control" id="address" name="address"
                                       value="{{ employee.address if employee else '' }}"
                                       placeholder="VD: Số nhà, Đường, Phường/Xã, Quận/Huyện, Thành phố">
                            </div>
                        </div>
                        
                        <!-- Buttons -->
                        <div class="row mt-4">
                            <div class="col-12 text-center">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> {{ 'Cập nhật' if employee else 'Thêm mới' }}
                                </button>
                                <a href="{{ url_for('employees') }}" class="btn btn-secondary">
                                    <i class="fas fa-times"></i> Hủy
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Form validation
(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();
</script>
{% endblock %}
