{% extends "base.html" %}

{% block title %}Báo cáo thống kê - HRMS{% endblock %}

{% block content %}
<div class="container-fluid">
    <h2 class="mb-4"><i class="fas fa-chart-bar"></i> Báo cáo thống kê</h2>
    
    <!-- Overview Statistics -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h6>Tổng nhân sự đang làm việc</h6>
                    <h2>{{ stats.total_active }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-secondary text-white">
                <div class="card-body">
                    <h6>Đã nghỉ hưu</h6>
                    <h2>{{ stats.total_retired }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <h6>Nam</h6>
                    <h2>{{ stats.by_gender.male }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <h6>Nữ</h6>
                    <h2>{{ stats.by_gender.female }}</h2>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Charts Row -->
    <div class="row mb-4">
        <!-- Department Distribution -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-building"></i> Phân bố theo đơn vị</h5>
                </div>
                <div class="card-body">
                    <canvas id="departmentChart"></canvas>
                    <div class="mt-3">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Đơn vị</th>
                                    <th>Số lượng</th>
                                    <th>Tỷ lệ</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for dept, count in stats.by_department.items() %}
                                <tr>
                                    <td>{{ dept }}</td>
                                    <td>{{ count }}</td>
                                    <td>{{ "%.1f"|format((count / stats.total_active * 100) if stats.total_active > 0 else 0) }}%</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Gender Distribution -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-venus-mars"></i> Cơ cấu giới tính</h5>
                </div>
                <div class="card-body">
                    <canvas id="genderChart"></canvas>
                    <div class="row mt-3">
                        <div class="col-6 text-center">
                            <h4 class="text-info">{{ stats.by_gender.male }}</h4>
                            <p>Nam ({{ "%.1f"|format((stats.by_gender.male / stats.total_active * 100) if stats.total_active > 0 else 0) }}%)</p>
                        </div>
                        <div class="col-6 text-center">
                            <h4 class="text-warning">{{ stats.by_gender.female }}</h4>
                            <p>Nữ ({{ "%.1f"|format((stats.by_gender.female / stats.total_active * 100) if stats.total_active > 0 else 0) }}%)</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Reports -->
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-file-alt"></i> Báo cáo nhanh</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <h6>Báo cáo định kỳ</h6>
                    <div class="list-group">
                        <button class="list-group-item list-group-item-action" onclick="generateReport('monthly')">
                            <i class="fas fa-calendar-alt"></i> Báo cáo tháng
                        </button>
                        <button class="list-group-item list-group-item-action" onclick="generateReport('quarterly')">
                            <i class="fas fa-calendar"></i> Báo cáo quý
                        </button>
                        <button class="list-group-item list-group-item-action" onclick="generateReport('yearly')">
                            <i class="fas fa-calendar-check"></i> Báo cáo năm
                        </button>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <h6>Báo cáo chuyên đề</h6>
                    <div class="list-group">
                        <button class="list-group-item list-group-item-action" onclick="generateReport('salary')">
                            <i class="fas fa-coins"></i> Báo cáo lương
                        </button>
                        <button class="list-group-item list-group-item-action" onclick="generateReport('retirement')">
                            <i class="fas fa-user-clock"></i> Báo cáo nghỉ hưu
                        </button>
                        <button class="list-group-item list-group-item-action" onclick="generateReport('training')">
                            <i class="fas fa-graduation-cap"></i> Báo cáo đào tạo
                        </button>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <h6>Xuất dữ liệu</h6>
                    <div class="list-group">
                        <button class="list-group-item list-group-item-action" onclick="exportData('excel')">
                            <i class="fas fa-file-excel text-success"></i> Xuất Excel tổng hợp
                        </button>
                        <button class="list-group-item list-group-item-action" onclick="exportData('word')">
                            <i class="fas fa-file-word text-primary"></i> Xuất báo cáo Word
                        </button>
                        <button class="list-group-item list-group-item-action" onclick="exportData('pdf')">
                            <i class="fas fa-file-pdf text-danger"></i> Xuất PDF
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Custom Report Builder -->
    <div class="card">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-tools"></i> Tạo báo cáo tùy chỉnh</h5>
        </div>
        <div class="card-body">
            <form>
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label">Loại báo cáo</label>
                        <select class="form-select">
                            <option>Danh sách nhân sự</option>
                            <option>Thống kê lương</option>
                            <option>Quá trình công tác</option>
                            <option>Đào tạo bồi dưỡng</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Khoảng thời gian</label>
                        <select class="form-select">
                            <option>Tháng này</option>
                            <option>Quý này</option>
                            <option>Năm nay</option>
                            <option>Tùy chọn...</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Định dạng xuất</label>
                        <select class="form-select">
                            <option>Excel (.xlsx)</option>
                            <option>Word (.docx)</option>
                            <option>PDF</option>
                        </select>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Đơn vị</label>
                        <select class="form-select" multiple>
                            <option selected>Tất cả</option>
                            {% for dept in stats.by_department.keys() %}
                            <option>{{ dept }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Các trường thông tin</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" checked id="check1">
                            <label class="form-check-label" for="check1">Thông tin cơ bản</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" checked id="check2">
                            <label class="form-check-label" for="check2">Thông tin công việc</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="check3">
                            <label class="form-check-label" for="check3">Thông tin lương</label>
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <button type="button" class="btn btn-primary">
                        <i class="fas fa-file-export"></i> Tạo báo cáo
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Department Chart
const deptCtx = document.getElementById('departmentChart').getContext('2d');
new Chart(deptCtx, {
    type: 'bar',
    data: {
        labels: {{ stats.by_department.keys()|list|tojson }},
        datasets: [{
            label: 'Số lượng nhân viên',
            data: {{ stats.by_department.values()|list|tojson }},
            backgroundColor: 'rgba(54, 162, 235, 0.5)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});

// Gender Chart
const genderCtx = document.getElementById('genderChart').getContext('2d');
new Chart(genderCtx, {
    type: 'doughnut',
    data: {
        labels: ['Nam', 'Nữ'],
        datasets: [{
            data: [{{ stats.by_gender.male }}, {{ stats.by_gender.female }}],
            backgroundColor: [
                'rgba(54, 162, 235, 0.8)',
                'rgba(255, 159, 64, 0.8)'
            ],
            borderColor: [
                'rgba(54, 162, 235, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false
    }
});

function generateReport(type) {
    alert('Đang tạo báo cáo ' + type + '...');
}

function exportData(format) {
    alert('Đang xuất dữ liệu định dạng ' + format + '...');
}
</script>
{% endblock %}
